// prosemirror-dropcursor@1.8.1 downloaded from https://ga.jspm.io/npm:prosemirror-dropcursor@1.8.1/dist/index.js

import{Plugin as e}from"prosemirror-state";import{dropPoint as t}from"prosemirror-transform";function dropCursor(t={}){return new e({view(e){return new DropCursorView(e,t)}})}class DropCursorView{constructor(e,t){var i;this.editorView=e;this.cursorPos=null;this.element=null;this.timeout=-1;this.width=null!==(i=t.width)&&void 0!==i?i:1;this.color=false===t.color?void 0:t.color||"black";this.class=t.class;this.handlers=["dragover","dragend","drop","dragleave"].map((t=>{let handler=e=>{this[t](e)};e.dom.addEventListener(t,handler);return{name:t,handler:handler}}))}destroy(){this.handlers.forEach((({name:e,handler:t})=>this.editorView.dom.removeEventListener(e,t)))}update(e,t){null!=this.cursorPos&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){if(e!=this.cursorPos){this.cursorPos=e;if(null==e){this.element.parentNode.removeChild(this.element);this.element=null}else this.updateOverlay()}}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos);let t,i=!e.parent.inlineContent;if(i){let i=e.nodeBefore,s=e.nodeAfter;if(i||s){let e=this.editorView.nodeDOM(this.cursorPos-(i?i.nodeSize:0));if(e){let o=e.getBoundingClientRect();let r=i?o.bottom:o.top;i&&s&&(r=(r+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);t={left:o.left,right:o.right,top:r-this.width/2,bottom:r+this.width/2}}}}if(!t){let e=this.editorView.coordsAtPos(this.cursorPos);t={left:e.left-this.width/2,right:e.left+this.width/2,top:e.top,bottom:e.bottom}}let s=this.editorView.dom.offsetParent;if(!this.element){this.element=s.appendChild(document.createElement("div"));this.class&&(this.element.className=this.class);this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;";this.color&&(this.element.style.backgroundColor=this.color)}this.element.classList.toggle("prosemirror-dropcursor-block",i);this.element.classList.toggle("prosemirror-dropcursor-inline",!i);let o,r;if(!s||s==document.body&&"static"==getComputedStyle(s).position){o=-pageXOffset;r=-pageYOffset}else{let e=s.getBoundingClientRect();o=e.left-s.scrollLeft;r=e.top-s.scrollTop}this.element.style.left=t.left-o+"px";this.element.style.top=t.top-r+"px";this.element.style.width=t.right-t.left+"px";this.element.style.height=t.bottom-t.top+"px"}scheduleRemoval(e){clearTimeout(this.timeout);this.timeout=setTimeout((()=>this.setCursor(null)),e)}dragover(e){if(!this.editorView.editable)return;let i=this.editorView.posAtCoords({left:e.clientX,top:e.clientY});let s=i&&i.inside>=0&&this.editorView.state.doc.nodeAt(i.inside);let o=s&&s.type.spec.disableDropCursor;let r="function"==typeof o?o(this.editorView,i,e):o;if(i&&!r){let e=i.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let i=t(this.editorView.state.doc,e,this.editorView.dragging.slice);null!=i&&(e=i)}this.setCursor(e);this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){e.target!=this.editorView.dom&&this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}export{dropCursor};

